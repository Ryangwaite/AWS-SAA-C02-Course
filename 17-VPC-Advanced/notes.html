<h2>VPC Advanced</h2>
<h3>VPC Flow Logs</h3>
<p>Capture packet metadata, not packet contents. Things like source IP,
destination IP, and packet size. Anything which could be observed
from the outside of the packet.</p>
<p>Capture data at various different monitoring points.</p>
<ul>
<li>VPC : all interfaces in that vpc</li>
<li>Subnets : interfaces in that subnet</li>
<li>Interface directly</li>
</ul>
<p>VPC flow logs are not realtime.</p>
<p>Desination can be S3 or CloudWatch logs.</p>
<p>Childs of interfaces inherit the flow low monitoring from higher groups.</p>
<p>The packet will always have source followed by destination.</p>
<h3>Egress-Only Internet Gateway</h3>
<p>IPv4 addresses are private or public</p>
<p>NAT allows private IPs to access public networks. It will not allow externally
initiated connections.</p>
<p>Using IPv6, all IPs are public.</p>
<p>Internet Gateway (IPv6) allows all IPs <strong>in</strong> and <strong>out</strong></p>
<p>Egress-only is <strong>outbound only</strong> for IPv6. It is exactly the same as
NAT, only outbound only.</p>
<p>To configure the Egress-only gateway, you must add default IPv6 route ::/0
added to RT with eigw-id as target.</p>
<h3>VPC Endpoints (Gateway)</h3>
<p>Provide private access to S3 and DynamoDB.</p>
<p>Normally when you want to access a public service through a VPC, you
need infrastructure to make this happen.</p>
<p>When you allocate a gateway endpoint to a subnet, a prefix list is added
to the route table.</p>
<p>The target is the gateway endpoint.</p>
<p>Any traffic destined for S3, goes via the gateway endpoint. The gateway
endpoint is highly available for all AZs in a region by default.</p>
<p>With a gateway endpoint you set which subnet will be used with it and
it will configure automatically.</p>
<p>A gateway endpoint is a VPC endpoint object.</p>
<p>Endpoint policy is used to control what things can be accessed by the endpoint.</p>
<p>Gateway endpoints can only be used to access services in the same region.
Can't access cross-region services.</p>
<p>S3 buckets can be set to private only by allowing access ONLY from
a gateway endpoint. For anything else, the implicit deny will apply.</p>
<p>They are only accessible from inside that specific VPC.</p>
<h3>VPC Endpoints (Interface)</h3>
<p>Provide private access to AWS Public Services
Anything EXCEPT S3 and DynamoDB</p>
<p>These are not HA by default and are added to specific subnets.</p>
<p>Must add one endpoint for one subnet per AZ</p>
<p>Network access controlled via security groups.</p>
<p>You can use Endpoint policies to restrict what can be accessed with
the endpoint.</p>
<p>ONLY TCP and IPv4 at the moment.</p>
<p>Behind the scenes, it uses PrivateLink.</p>
<p>Endpoint provides a <strong>NEW</strong> service endpoint DNS</p>
<p>e.g. vpce-123-xyz.sns.us-east-1.vpce.amazonaws.com</p>
<ul>
<li>Endpoint : Regional DNS</li>
<li>Endpoint : Zonal DNS</li>
</ul>
<p>Either of those two points of endpoints can be used</p>
<p>PrivateDNS overrides the default DNS for services.</p>
<h3>VPC Peering</h3>
<p>Direct encrypted network link between two VPCs</p>
<p>Works in the same or cross region and in the same or across accounts.</p>
<p>VPC peers have the option to allow Public Hostnames to resolve to
private IPs.</p>
<p>Same region SG's can reference peer security groups. This allows for the
same nesting of security groups within that region.</p>
<p>In different regions, you need to reference IP peers.</p>
<p>VPC peering connects <strong>ONLY TWO</strong></p>
<p>VPC Peering does not support <strong>transitive peering</strong></p>
<p>If you want to connect 3 VPCs, you need 3 connections. You can't route
through interconnected VPCs.</p>
<p>You are creating a logical gateway object in one VPC.</p>
<p>VPC Peering Connections CANNOT be created with overlapping VPC CIDRs</p>
